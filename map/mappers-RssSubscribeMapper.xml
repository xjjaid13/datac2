<?xml version="1.0" encoding="GBK"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dao.RssSubscribeMapperDao">
  <resultMap id="rssSubscribe" type="RssSubscribe">
    <result property="rssSubscribeId" column="rssSubscribeId"/>
    <result property="rssId" column="rssId"/>
    <result property="rssTypeId" column="rssTypeId"/>
  </resultMap>
  <resultMap id="rss" type="Rss">
    <result property="rssId" column="rssId"/>
    <result property="rssTitle" column="rssTitle"/>
    <result property="rssUrl" column="rssUrl"/>
    <result property="rssIcon" column="rssIcon"/>
    <result property="fingePrint" column="fingePrint"/>
    <result property="isSubscribe" column="isSubscribe"/>
    <result property="updateTime" column="updateTime"/>
    <collection property="rssCrawlList" ofType="RssCrawl">
    	<result property="rssCrawlId" column="rssCrawlId"/>
	    <result property="rssId" column="rssId"/>
	    <result property="resourceTitle" column="resourceTitle"/>
	    <result property="resourceUrl" column="resourceUrl"/>
	    <result property="updateTime" column="crawlUpdateTime"/>
	    <result property="resourceDesc" column="resourceDesc"/>
    </collection>
  </resultMap>
  <select id="select" resultType="java.util.Map" resultMap="rssSubscribe">select * from rss_subscribe where 1 = 1 
    <if test="rssSubscribeId != null">and rssSubscribeId = #{rssSubscribeId}</if>  
    <if test="rssId != null">and rssId = #{rssId}</if>  
    <if test="rssTypeId != null">and rssTypeId = #{rssTypeId}</if>  
    <if test="condition != null">${condition}</if>
  </select>
  <select id="selectList" resultType="java.util.List" resultMap="rssSubscribe">select * from rss_subscribe where 1 = 1 
    <if test="rssSubscribeId != null">and rssSubscribeId = #{rssSubscribeId}</if>  
    <if test="rssId != null">and rssId = #{rssId}</if>  
    <if test="rssTypeId != null">and rssTypeId = #{rssTypeId}</if>  
    <if test="condition != null">${condition}</if>  
    <if test="startPage != -1">limit #{startPage},#{page}</if> 
  </select>
  <select id="selectCount" resultType="java.lang.Integer">select count(rssSubscribeId) from rss_subscribe where 1 = 1 
    <if test="rssSubscribeId != null">and rssSubscribeId = #{rssSubscribeId}</if>  
    <if test="rssId != null">and rssId = #{rssId}</if>  
    <if test="rssTypeId != null">and rssTypeId = #{rssTypeId}</if>  
    <if test="condition != null">${condition}</if> 
  </select>
  <insert id="insert" parameterType="RssSubscribe">insert into rss_subscribe (rssSubscribeId,rssId,rssTypeId) values (#{rssSubscribeId},#{rssId},#{rssTypeId})</insert>
  <update id="update" parameterType="RssSubscribe">update rss_subscribe 
    <set> 
      <if test="rssSubscribeId != null">rssSubscribeId = #{rssSubscribeId},</if>
      <if test="rssId != null">rssId = #{rssId},</if>
      <if test="rssTypeId != null">rssTypeId = #{rssTypeId},</if> 
    </set> where 1 = 1 
    <if test="rssSubscribeId != null">and rssSubscribeId = #{rssSubscribeId}</if>
    <if test="condition != null">${condition}</if>
  </update>
  <delete id="delete" parameterType="RssSubscribe">delete from rss_subscribe where 1 = 1 
    <if test="rssSubscribeId != null">and rssSubscribeId = #{rssSubscribeId}</if>  
    <if test="rssId != null">and rssId = #{rssId}</if>  
    <if test="rssTypeId != null">and rssTypeId = #{rssTypeId}</if>  
    <if test="condition != null">${condition}</if>
  </delete>
  <delete id="deleteByIds" parameterType="RssSubscribe">delete from rss_subscribe where rssSubscribeId in (${ids})</delete>
  <select id="maxId" resultType="java.lang.Integer">select max(rssSubscribeId) from rss_subscribe</select>
  <select id="selectTypeSubscribe" parameterType="RssSubscribe" resultType="java.util.List" resultMap="rss">select b.* from rss_subscribe a left join rss b on a.rssId = b.rssId where a.rssTypeId = #{rssTypeId} order by rssSubscribeId desc</select>
  <select id="selectListJoin" parameterType="RssType" resultType="java.util.List" resultMap="rssSubscribe" >
  	select a.* from rss_subscribe a left join rss_type b on a.rssTypeId = b.rssTypeId left join rss c on a.rssId = c.rssId where <if test="userId != null"> b.userId = #{userId} </if> <if test="rssTypeId != null"> b.rssTypeId = #{rssTypeId} </if>  order by c.updateTime desc <if test="startPage != -1">limit #{startPage},#{page}</if> 
  </select>
  <select id="selectListByIds" resultType="java.util.List" resultMap="rss" parameterType="RssSubscribe">
  	select c.*,temp.*,temp.updateTime as crawlUpdateTime from (select a.* from rss_crawl a where (select count(*) from rss_crawl b where a.rssId = b.rssId and b.rssCrawlId > a.rssCrawlId)  &lt; 3 and a.rssId in (${ids})  order by a.updateTime desc) temp LEFT JOIN rss c on temp.rssId = c.rssId order by c.updateTime desc
  </select>
</mapper>
